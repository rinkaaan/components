{"version":3,"file":"object-definition.js","sourceRoot":"","sources":["../../src/components/object-definition.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport ts from 'typescript';\nimport type { TypeDefinition, UnionTypeDefinition, ValueDescription } from './interfaces';\nimport { extractDeclaration, isOptional, stringifyType } from '../shared/type-utils';\nimport { extractValueDescriptions } from './extract-value-descriptions';\n\nfunction getOriginalTypeName(rawTypeNode: ts.TypeNode) {\n  // If the type node is a type reference (like `ButtonGroupProps.Variant`), get its text\n  if (ts.isTypeReferenceNode(rawTypeNode) || ts.isQualifiedName(rawTypeNode)) {\n    return rawTypeNode.getText();\n  }\n}\n\nfunction trimQuotes(s: string) {\n  return s.replace(/^\"(.+)\"$/, '$1');\n}\n\nfunction isArrayType(type: ts.Type) {\n  const symbol = type.getSymbol();\n  if (!symbol) {\n    return false;\n  }\n  return symbol.getName() === 'Array' || symbol.getName() === 'ReadonlyArray';\n}\n\nexport function getObjectDefinition(\n  type: string,\n  rawType: ts.Type,\n  rawTypeNode: ts.TypeNode | undefined,\n  checker: ts.TypeChecker,\n): { type: string; inlineType?: TypeDefinition } {\n  const realType = rawType.getNonNullableType();\n  const realTypeName = stringifyType(realType, checker);\n\n  if (realType.flags & ts.TypeFlags.StringLiteral) {\n    // For string literals, try to get the original type name from the type node.\n    // This preserves user-defined type aliases like `ButtonGroupProps.Variant`\n    const name = (rawTypeNode && getOriginalTypeName(rawTypeNode)) || trimQuotes(realTypeName);\n\n    return {\n      type: 'string',\n      inlineType: {\n        name,\n        type: 'union',\n        values: [trimQuotes(type)],\n      },\n    };\n  }\n\n  if (\n    realType.flags & ts.TypeFlags.String ||\n    realType.flags & ts.TypeFlags.Literal ||\n    realType.flags & ts.TypeFlags.Boolean ||\n    realType.flags & ts.TypeFlags.Number ||\n    isArrayType(realType) ||\n    realTypeName === 'HTMLElement' ||\n    realTypeName.split('.')[0] === 'Highcharts' ||\n    type === 'React.ReactNode'\n  ) {\n    // do not expand built-in Javascript methods or primitive values\n    return { type };\n  }\n  if (realType.isUnionOrIntersection()) {\n    return getUnionTypeDefinition(realTypeName, realType, rawTypeNode, checker);\n  }\n  if (realType.getProperties().length > 0) {\n    const properties = realType\n      .getProperties()\n      .map(prop => {\n        const propNode = extractDeclaration(prop) as ts.PropertyDeclaration;\n        const propType = checker.getTypeAtLocation(propNode);\n        const typeString = stringifyType(propType, checker);\n\n        return {\n          name: prop.getName(),\n          optional: isOptional(propType),\n          ...getObjectDefinition(typeString, propType, propNode.type, checker),\n        };\n      })\n      .sort((a, b) => a.name.localeCompare(b.name));\n    return {\n      type: type,\n      inlineType: {\n        name: realTypeName.length < 100 ? realTypeName : 'object',\n        type: 'object',\n        properties: properties,\n      },\n    };\n  }\n  if (realType.getCallSignatures().length > 0) {\n    if (realType.getCallSignatures().length > 1) {\n      throw new Error('Multiple call signatures are not supported');\n    }\n    const signature = realType.getCallSignatures()[0];\n\n    return {\n      type,\n      inlineType: {\n        name: realTypeName,\n        type: 'function',\n        returnType: stringifyType(signature.getReturnType(), checker),\n        parameters: signature.getParameters().map(param => {\n          const paramType = checker.getTypeAtLocation(extractDeclaration(param));\n          return {\n            name: param.getName(),\n            type: stringifyType(paramType, checker),\n          };\n        }),\n      },\n    };\n  }\n  return { type };\n}\n\nfunction getPrimitiveType(type: ts.UnionOrIntersectionType) {\n  if (type.types.every(subtype => subtype.isStringLiteral())) {\n    return 'string';\n  }\n  if (type.types.every(subtype => subtype.isNumberLiteral())) {\n    return 'number';\n  }\n  return undefined;\n}\n\nfunction getUnionTypeDefinition(\n  realTypeName: string,\n  realType: ts.UnionOrIntersectionType,\n  typeNode: ts.TypeNode | undefined,\n  checker: ts.TypeChecker,\n): { type: string; inlineType: UnionTypeDefinition } {\n  const valueDescriptions = extractValueDescriptions(realType, typeNode);\n  const primitiveType = getPrimitiveType(realType);\n  const values = realType.types.map(subtype =>\n    primitiveType ? (subtype as ts.LiteralType).value.toString() : stringifyType(subtype, checker),\n  );\n\n  return {\n    type: primitiveType ?? realTypeName,\n    inlineType: {\n      name: realTypeName,\n      type: 'union',\n      valueDescriptions: valueDescriptions.length > 0 ? zipValueDescriptions(values, valueDescriptions) : undefined,\n      values: values,\n    },\n  };\n}\n\nfunction zipValueDescriptions(values: Array<string>, descriptions: Array<ValueDescription | undefined>) {\n  const descriptionsMap: Record<string, ValueDescription> = {};\n  values.forEach((value, index) => {\n    const description = descriptions[index];\n    if (description) {\n      descriptionsMap[value] = description;\n    }\n  });\n  return descriptionsMap;\n}\n"]}