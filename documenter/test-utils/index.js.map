{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/test-utils/index.ts"],"names":[],"mappings":";;;;;AAyBA,8CA8BC;AAED,kEAqBC;AA9ED,qEAAqE;AACrE,sCAAsC;AACtC,sDAAyB;AACzB,kDAA0B;AAC1B,mDAAiE;AACjE,4DAA+C;AAoB/C,SAAgB,iBAAiB,CAAC,OAAmC;;IACnE,MAAM,YAAY,GAAG,eAAK,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IAC1D,MAAM,kBAAkB,GAAG,eAAK,CAAC,OAAO,CAAC,OAAO,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;IACtE,MAAM,OAAO,GAAG,IAAA,sCAA0B,EAAC,OAAO,CAAC,YAAY,CAAC,CAAC;IACjE,MAAM,OAAO,GAAG,OAAO,CAAC,cAAc,EAAE,CAAC;IAEzC,MAAM,YAAY,GAAG,OAAO,CAAC,cAAc,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,KAAK,YAAY,CAAC,CAAC;IAC3F,IAAI,CAAC,YAAY,EAAE,CAAC;QAClB,MAAM,IAAI,KAAK,CAAC,SAAS,YAAY,aAAa,CAAC,CAAC;IACtD,CAAC;IAED,MAAM,kBAAkB,GAAG,OAAO,CAAC,cAAc,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,KAAK,kBAAkB,CAAC,CAAC;IACvG,IAAI,CAAC,kBAAkB,EAAE,CAAC;QACxB,MAAM,IAAI,KAAK,CAAC,SAAS,kBAAkB,aAAa,CAAC,CAAC;IAC5D,CAAC;IACD,MAAM,kBAAkB,GAAG,MAAA,OAAO,CAAC,kBAAkB,mCAAI,KAAK,CAAC;IAC/D,OAAO;QACL,cAAc,EAAE,IAAA,mBAAoB,EAClC,YAAY,EACZ,OAAO,EACP,MAAA,OAAO,CAAC,QAAQ,CAAC,YAAY,mCAAI,EAAE,EACnC,kBAAkB,CACnB;QACD,oBAAoB,EAAE,IAAA,mBAAoB,EACxC,kBAAkB,EAClB,OAAO,EACP,MAAA,OAAO,CAAC,cAAc,CAAC,YAAY,mCAAI,EAAE,EACzC,kBAAkB,CACnB;KACF,CAAC;AACJ,CAAC;AAED,SAAgB,2BAA2B,CAAC,EAC1C,MAAM,EACN,GAAG,IAAI,EACyC;IAChD,MAAM,EAAE,cAAc,EAAE,oBAAoB,EAAE,GAAG,iBAAiB,CAAC,IAAI,CAAC,CAAC;IACzE,iBAAE,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;IAC1C,iBAAE,CAAC,aAAa,CACd,eAAK,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,EAC5B,+BAA+B,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,IAAI,EAAE,CAAC,CAAC,KAAK,CAC5E,CAAC;IACF,iBAAE,CAAC,aAAa,CACd,eAAK,CAAC,IAAI,CAAC,MAAM,EAAE,cAAc,CAAC,EAClC,+BAA+B,IAAI,CAAC,SAAS,CAAC,oBAAoB,EAAE,IAAI,EAAE,CAAC,CAAC,KAAK,CAClF,CAAC;IACF,iBAAE,CAAC,YAAY,CAAC,OAAO,CAAC,OAAO,CAAC,mBAAmB,CAAC,EAAE,eAAK,CAAC,IAAI,CAAC,MAAM,EAAE,iBAAiB,CAAC,CAAC,CAAC;IAC7F,MAAM,WAAW,GAAG;;;GAGnB,CAAC;IACF,iBAAE,CAAC,aAAa,CAAC,eAAK,CAAC,IAAI,CAAC,MAAM,EAAE,UAAU,CAAC,EAAE,WAAW,CAAC,CAAC;IAC9D,iBAAE,CAAC,aAAa,CAAC,eAAK,CAAC,IAAI,CAAC,MAAM,EAAE,gBAAgB,CAAC,EAAE,WAAW,CAAC,CAAC;AACtE,CAAC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport fs from 'node:fs';\nimport pathe from 'pathe';\nimport { bootstrapTypescriptProject } from '../shared/bootstrap';\nimport extractDocumentation from './extractor';\nimport { TestUtilsDoc } from './interfaces';\n\nexport interface TestUtilsVariantOptions {\n  root: string;\n  extraExports?: Array<string>;\n}\n\nexport interface TestUtilsDocumenterOptions {\n  tsconfigPath: string;\n  includeCoreMethods?: boolean;\n  domUtils: TestUtilsVariantOptions;\n  selectorsUtils: TestUtilsVariantOptions;\n}\n\ninterface TestUtilsDefinitions {\n  domDefinitions: Array<TestUtilsDoc>;\n  selectorsDefinitions: Array<TestUtilsDoc>;\n}\n\nexport function documentTestUtils(options: TestUtilsDocumenterOptions): TestUtilsDefinitions {\n  const domUtilsRoot = pathe.resolve(options.domUtils.root);\n  const selectorsUtilsRoot = pathe.resolve(options.selectorsUtils.root);\n  const program = bootstrapTypescriptProject(options.tsconfigPath);\n  const checker = program.getTypeChecker();\n\n  const domUtilsFile = program.getSourceFiles().find(file => file.fileName === domUtilsRoot);\n  if (!domUtilsFile) {\n    throw new Error(`File '${domUtilsRoot}' not found`);\n  }\n\n  const selectorsUtilsFile = program.getSourceFiles().find(file => file.fileName === selectorsUtilsRoot);\n  if (!selectorsUtilsFile) {\n    throw new Error(`File '${selectorsUtilsFile}' not found`);\n  }\n  const includeCoreMethods = options.includeCoreMethods ?? false;\n  return {\n    domDefinitions: extractDocumentation(\n      domUtilsFile,\n      checker,\n      options.domUtils.extraExports ?? [],\n      includeCoreMethods,\n    ),\n    selectorsDefinitions: extractDocumentation(\n      selectorsUtilsFile,\n      checker,\n      options.selectorsUtils.extraExports ?? [],\n      includeCoreMethods,\n    ),\n  };\n}\n\nexport function writeTestUtilsDocumentation({\n  outDir,\n  ...rest\n}: TestUtilsDocumenterOptions & { outDir: string }): void {\n  const { domDefinitions, selectorsDefinitions } = documentTestUtils(rest);\n  fs.mkdirSync(outDir, { recursive: true });\n  fs.writeFileSync(\n    pathe.join(outDir, 'dom.js'),\n    `module.exports = { classes: ${JSON.stringify(domDefinitions, null, 2)} };`,\n  );\n  fs.writeFileSync(\n    pathe.join(outDir, 'selectors.js'),\n    `module.exports = { classes: ${JSON.stringify(selectorsDefinitions, null, 2)} };`,\n  );\n  fs.copyFileSync(require.resolve('./interfaces.d.ts'), pathe.join(outDir, 'interfaces.d.ts'));\n  const dtsTemplate = `import { TestUtilsDefinition } from './interfaces';\n  declare const definitions: TestUtilsDefinition;\n  export = definitions;\n  `;\n  fs.writeFileSync(pathe.join(outDir, 'dom.d.ts'), dtsTemplate);\n  fs.writeFileSync(pathe.join(outDir, 'selectors.d.ts'), dtsTemplate);\n}\n"]}